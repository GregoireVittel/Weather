<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>M√©t√©o ‚Äì Croissy-sur-Seine</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background: linear-gradient(135deg, #0f2847 0%, #1e3c72 100%);
            padding: 20px 10px;
            min-height: 100vh;
            color: #ffffff;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            background: rgba(30, 60, 114, 0.9);
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 16px 40px rgba(0, 0, 0, 0.5);
        }

        h1 {
            text-align: center;
            font-size: 1.2rem;
            margin-bottom: 20px;
        }

        .current {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
        }

        .temp {
            font-size: 3rem;
            font-weight: 700;
            color: #ffd700;
            margin: 10px 0;
        }

        .condition {
            font-size: 1.1rem;
            color: #87ceeb;
            margin-bottom: 15px;
        }

        .details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            font-size: 0.9rem;
        }

        .detail {
            background: rgba(0, 0, 0, 0.2);
            padding: 8px;
            border-radius: 6px;
        }

        .btn {
            display: block;
            width: 120px;
            margin: 20px auto;
            padding: 8px;
            background: #87ceeb;
            color: #0f2847;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
        }

        .btn:hover {
            background: #ffd700;
        }

        .loading, .error {
            text-align: center;
            padding: 40px 20px;
            font-size: 1rem;
        }

        .error {
            color: #ff6b6b;
        }

        .hidden {
            display: none !important;
        }

            margin-top: 15px;
            max-height: 250px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üå§Ô∏è M√©t√©o Croissy-sur-Seine</h1>

        <div id="loading" class="loading">Chargement‚Ä¶</div>
        <div id="error" class="error hidden"></div>

        <div id="current" class="current hidden">
            <div id="icon" style="font-size: 3rem;"></div>
            <div class="temp" id="temp"></div>
            <div class="condition" id="condition"></div>
            <div class="details">
                <div class="detail">üíß <span id="humidity"></span>%</div>
                <div class="detail">üí® <span id="wind"></span> km/h</div>
                <div class="detail">‚òÅÔ∏è <span id="cloud"></span>%</div>
                <div class="detail">üåßÔ∏è <span id="rain"></span> mm</div>
            </div>
        </div>

        <button id="btn" class="btn">üîÑ Actualiser</button>

        <div id="hourly-section" class="hidden">
            <h2 style="text-align: center; font-size: 1rem; margin: 20px 0 10px; color: #87ceeb;">üìä Pr√©visions horaires</h2>
            <div style="overflow-x: auto;">
                <table style="width: 100%; font-size: 0.75rem; border-collapse: collapse;">
                    <thead>
                        <tr style="background: rgba(0,0,0,0.3);">
                            <th style="padding: 6px; text-align: left;">Heure</th>
                            <th style="padding: 6px; text-align: center;">üå§Ô∏è</th>
                            <th style="padding: 6px; text-align: center;">Temp</th>
                            <th style="padding: 6px; text-align: center;">üíß%</th>
                            <th style="padding: 6px; text-align: center;">üåßÔ∏èmm</th>
                            <th style="padding: 6px; text-align: center;">üí®km/h</th>
                        </tr>
                    </thead>
                    <tbody id="hourly-body"></tbody>
                </table>
            </div>
            <div id="rain-chart">
                <canvas id="rainChart"></canvas>
            </div>
        </div>

        <div id="daily-section" class="hidden">
            <h2 style="text-align: center; font-size: 1rem; margin: 20px 0 10px; color: #87ceeb;">üìÖ Pr√©visions 7 jours</h2>
            <div style="overflow-x: auto;">
                <table style="width: 100%; font-size: 0.8rem; border-collapse: collapse;">
                    <thead>
                        <tr style="background: rgba(0,0,0,0.3);">
                            <th style="padding: 8px; text-align: left;">Jour</th>
                            <th style="padding: 8px; text-align: center;">üå§Ô∏è</th>
                            <th style="padding: 8px; text-align: center;">Max</th>
                            <th style="padding: 8px; text-align: center;">Min</th>
                            <th style="padding: 8px; text-align: center;">üíß%</th>
                        </tr>
                    </thead>
                    <tbody id="daily-body"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        const lat = 48.8797, lon = 2.1439;
        let rainChart = null;

        const codes = {
            0: { desc: "D√©gag√©", day: "‚òÄÔ∏è", night: "üåô" },
            1: { desc: "Plut√¥t d√©gag√©", day: "üå§Ô∏è", night: "üåô" },
            2: { desc: "Nuageux", day: "‚õÖ", night: "‚òÅÔ∏è" },
            3: { desc: "Couvert", day: "‚òÅÔ∏è", night: "‚òÅÔ∏è" },
            45: { desc: "Brouillard", day: "üå´Ô∏è", night: "üå´Ô∏è" },
            48: { desc: "Brouillard", day: "üå´Ô∏è", night: "üå´Ô∏è" },
            51: { desc: "Bruine", day: "üå¶Ô∏è", night: "üåßÔ∏è" },
            53: { desc: "Bruine", day: "üå¶Ô∏è", night: "üåßÔ∏è" },
            61: { desc: "Pluie l√©g√®re", day: "üåßÔ∏è", night: "üåßÔ∏è" },
            63: { desc: "Pluie", day: "üåßÔ∏è", night: "üåßÔ∏è" },
            65: { desc: "Pluie forte", day: "üåßÔ∏è", night: "üåßÔ∏è" },
            71: { desc: "Neige l√©g√®re", day: "üå®Ô∏è", night: "üå®Ô∏è" },
            73: { desc: "Neige", day: "üå®Ô∏è", night: "üå®Ô∏è" },
            75: { desc: "Neige forte", day: "‚ùÑÔ∏è", night: "‚ùÑÔ∏è" },
            80: { desc: "Averses", day: "üå¶Ô∏è", night: "üåßÔ∏è" },
            82: { desc: "Averses fortes", day: "‚õàÔ∏è", night: "‚õàÔ∏è" },
            95: { desc: "Orage", day: "‚õàÔ∏è", night: "‚õàÔ∏è" },
        };

        function formatHour(dateStr) {
            const date = new Date(dateStr);
            const day = date.toLocaleDateString("fr-FR", { weekday: "short", day: "numeric" });
            const time = date.toLocaleTimeString("fr-FR", { hour: "2-digit", minute: "2-digit", hour12: false });
            return `${day} ${time}`;
        }

        function formatDate(dateStr) {
            return new Date(dateStr).toLocaleDateString("fr-FR", { weekday: "short", month: "short", day: "numeric" });
        }

        function getIcon(code, date) {
            const w = codes[code] || { day: "üå°Ô∏è", night: "üå°Ô∏è" };
            const h = new Date(date).getHours();
            return h >= 6 && h < 20 ? w.day : w.night;
        }

        function getDesc(code) {
            return (codes[code] || { desc: "Inconnu" }).desc;
        }

        async function fetch_weather() {
            try {
                document.getElementById("loading").classList.remove("hidden");
                document.getElementById("error").classList.add("hidden");
                document.getElementById("current").classList.add("hidden");

                const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,weather_code,relative_humidity_2m,precipitation,cloud_cover,wind_speed_10m&hourly=temperature_2m,precipitation_probability,rain,wind_speed_10m,weather_code&daily=weather_code,temperature_2m_max,temperature_2m_min,precipitation_probability_max&timezone=Europe/Paris`;

                const res = await fetch(url);
                const data = await res.json();
                const c = data.current;

                document.getElementById("icon").textContent = getIcon(c.weather_code, new Date().toISOString());
                document.getElementById("temp").textContent = Math.round(c.temperature_2m) + "¬∞C";
                document.getElementById("condition").textContent = getDesc(c.weather_code);
                document.getElementById("humidity").textContent = c.relative_humidity_2m;
                document.getElementById("wind").textContent = Math.round(c.wind_speed_10m);
                document.getElementById("cloud").textContent = c.cloud_cover;
                document.getElementById("rain").textContent = c.rain;

                document.getElementById("loading").classList.add("hidden");
                document.getElementById("current").classList.remove("hidden");
                displayHourly(data.hourly);
                displayDaily(data.daily);
                document.getElementById("hourly-section").classList.remove("hidden");
                document.getElementById("daily-section").classList.remove("hidden");
            } catch (e) {
                document.getElementById("loading").classList.add("hidden");
                document.getElementById("error").classList.remove("hidden");
                document.getElementById("error").textContent = "Erreur: " + e.message;
            }
        }

        function displayHourly(hourly) {
            const tbody = document.getElementById("hourly-body");
            let html = "";
            const now = new Date();
            let count = 0;
            const times = [];
            const rains = [];
            for (let i = 0; i < hourly.time.length && count < 24; i++) {
                const hourTime = new Date(hourly.time[i]);
                if (hourTime > now) {
                    const icon = getIcon(hourly.weather_code[i], hourly.time[i]);
                    const time = formatHour(hourly.time[i]);
                    const temp = Math.round(hourly.temperature_2m[i]);
                    const precip = hourly.precipitation_probability[i];
                    const rain = hourly.rain[i];
                    const wind = Math.round(hourly.wind_speed_10m[i]);
                    html += `<tr style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                        <td style="padding: 6px;">${time}</td>
                        <td style="padding: 6px; text-align: center; font-size: 1.2rem;">${icon}</td>
                        <td style="padding: 6px; text-align: center; color: #ffd700;">${temp}¬∞</td>
                        <td style="padding: 6px; text-align: center;">${precip}%</td>
                        <td style="padding: 6px; text-align: center;">${rain}</td>
                        <td style="padding: 6px; text-align: center;">${wind}</td>
                    </tr>`;
                    times.push(time);
                    rains.push(rain);
                    count++;
                }
            }
            tbody.innerHTML = html;
            createRainChart(times, rains);
        }

        function createRainChart(labels, data) {
            const ctx = document.getElementById("rainChart").getContext("2d");
            if (rainChart) rainChart.destroy();
            rainChart = new Chart(ctx, {
                type: "bar",
                data: {
                    labels: labels,
                    datasets: [{
                        label: "Pluie (mm)",
                        data: data,
                        backgroundColor: "rgba(135, 206, 235, 0.6)",
                        borderColor: "#87ceeb",
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: { labels: { color: "#ffffff" } }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { color: "rgba(255,255,255,0.1)" },
                            ticks: { color: "#ffffff" }
                        },
                        x: {
                            grid: { display: false },
                            ticks: { color: "#ffffff", font: { size: 9 } }
                        }
                    }
                }
            });
        }

        function displayDaily(daily) {
            const tbody = document.getElementById("daily-body");
            let html = "";
            for (let i = 0; i < 7; i++) {
                const icon = getIcon(daily.weather_code[i], daily.time[i] + "T12:00:00");
                const date = formatDate(daily.time[i]);
                const max = Math.round(daily.temperature_2m_max[i]);
                const min = Math.round(daily.temperature_2m_min[i]);
                const rain = daily.precipitation_probability_max[i];
                html += `<tr style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                    <td style="padding: 8px;">${date}</td>
                    <td style="padding: 8px; text-align: center; font-size: 1.3rem;">${icon}</td>
                    <td style="padding: 8px; text-align: center; color: #ffd700; font-weight: 600;">${max}¬∞</td>
                    <td style="padding: 8px; text-align: center; color: #87ceeb;">${min}¬∞</td>
                    <td style="padding: 8px; text-align: center;">${rain}%</td>
                </tr>`;
            }
            tbody.innerHTML = html;
        }

        document.getElementById("btn").addEventListener("click", fetch_weather);
        fetch_weather();
    </script>
</body>
</html>
